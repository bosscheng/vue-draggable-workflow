(function(t){function e(e){for(var o,s,l=e[0],r=e[1],d=e[2],u=0,f=[];u<l.length;u++)s=l[u],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&f.push(i[s][0]),i[s]=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);c&&c(e);while(f.length)f.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],o=!0,l=1;l<n.length;l++){var r=n[l];0!==i[r]&&(o=!1)}o&&(a.splice(e--,1),t=s(s.s=n[0]))}return t}var o={},i={app:0},a=[];function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=o,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/vue-draggable-workflow/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],r=l.push.bind(l);l.push=e,l=l.slice();for(var d=0;d<l.length;d++)e(l[d]);var c=r;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},5052:function(t,e,n){"use strict";var o=n("b37d"),i=n.n(o);i.a},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("workflow")],1)},a=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"flow-layout"},[n("div",{staticClass:"flow-editor"},[n("div",{staticClass:"flow-tools"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"手动排列",placement:"top-start"}},[n("div",{staticClass:"tool-item",attrs:{title:""},on:{click:t.handleSort}},[n("span",{staticClass:"icon-duiqi"})])]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"自动排列",placement:"top-start"}},[n("div",{staticClass:"tool-item",on:{click:t.handleToggleAutoSort}},[n("span",{class:t.toggleSortClass})])]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"撤销",placement:"top-start"}},[n("div",{staticClass:"tool-item",on:{click:t.handleUndo}},[n("span",{staticClass:"icon-undo",class:{"icon-undo-disabled":!t.canUndo}})])]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"重做",placement:"top-start"}},[n("div",{staticClass:"tool-item",on:{click:t.handleClear}},[n("span",{staticClass:"icon-redo"})])]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"获取JSON数据",placement:"top-start"}},[n("div",{staticClass:"tool-item",on:{click:t.handleGetData}},[n("span",{staticClass:"icon-json"})])]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"网格",placement:"top-start"}},[n("div",{staticClass:"tool-item",on:{click:function(e){t.toggleGridLine=!t.toggleGridLine}}},[n("span",{class:t.toggleGridLineClass})])])],1),n("div",{staticClass:"flow-zoom",attrs:{"data-zoom":t.canvasDataRoom+"%"}},[n("div",{staticClass:"zoom-btn"},[n("el-button",{class:{"el-button--primary":t.canvasRoomMinusEnable},attrs:{size:"mini",icon:"el-icon-minus",circle:""},on:{click:t.handleMinusCanvas}})],1),n("div",{staticClass:"zoom-btn"},[n("el-button",{class:{"el-button--primary":t.canvasRoomPlusEnable},attrs:{size:"mini",icon:"el-icon-plus",circle:""},on:{click:t.handlePlusCanvas}})],1)]),n("div",{staticClass:"canvas-container",class:{"show-grid":t.toggleGridLine},attrs:{"data-zoom":t.canvasDataRoom}},[n("div",{ref:"campaignCanvas",style:t.canvasRoomScaleStyle,attrs:{id:"campaignCanvas"}},[t._l(t.flowList,(function(e,o){return[n("div",{key:e.uuid,staticClass:"node-content-wrap",style:{left:e.left+"px",top:e.top+"px"},attrs:{id:e.uuid},on:{mousedown:t.handleFlowMoveDown,mouseup:function(n){t.handleChangeFlowPosition(e,n)},click:function(n){return n.stopPropagation(),function(n){t.handleEditFlowItem(e,n)}(n)}}},[n("div",{staticClass:"node-content"},[n("draggable",{ref:e.uuid,refInFor:!0,staticClass:"node-temp-small",attrs:{group:{name:"sortable",pull:!1,put:!0}}}),e.groupType===t.flowTypeConstant.action?[n("div",{staticClass:"flow-item node"},[n("div",{staticClass:"step-img",class:e.className}),n("div",{staticClass:"step-title"},[t._v(t._s(e.name))])]),n("div",{staticClass:"flow-text"},[n("div",{staticClass:"text-line"},[n("span",[t._v(t._s(e.formData&&e.formData.stepName))]),n("i",{staticClass:"el-icon-close flow-delete",on:{click:function(n){return n.stopPropagation(),t.handleDeleteFlowItem(e)}}})])])]:e.groupType===t.flowTypeConstant.condition?[n("div",{staticClass:"flow-item node-square"},[n("div",{staticClass:"square"},[n("div",{staticClass:"step-img",class:e.className})])]),n("div",{staticClass:"flow-text"},[n("div",{staticClass:"text-line"},[n("span",[t._v(t._s(e.formData&&e.formData.stepName))]),n("i",{staticClass:"el-icon-close flow-delete",on:{click:function(n){return n.stopPropagation(),t.handleDeleteFlowItem(e)}}})]),n("div",{staticClass:"text-line1"},[e.formData&&e.formData.ifNodeTitle?[n("span",{staticClass:"text-content"},[t._v(t._s(e.formData.ifNodeTitle))])]:t._e()],2)])]:e.groupType===t.flowTypeConstant.flow?[n("div",{staticClass:"flow-item node node-circle"},[n("div",{staticClass:"step-img",class:e.className})]),n("div",{staticClass:"flow-text"},[n("div",{staticClass:"text-line"},[n("span",[t._v(t._s(e.formData&&e.formData.stepName))]),e.type!==t.flowItemTypeConstant.startNode?n("i",{staticClass:"el-icon-close flow-delete",on:{click:function(n){return n.stopPropagation(),t.handleDeleteFlowItem(e)}}}):t._e()])])]:t._e(),e.groupType===t.flowTypeConstant.temp?[n("draggable",{ref:"tempNode",refInFor:!0,staticClass:"flow-item node-temp node-temp-img",attrs:{id:e.uuid,group:{name:"sortable",pull:!1,put:!0}}})]:t._e()],2)])]}))],2)]),n("div",{staticClass:"flow-editor-sidebar"},[t._l(t.flowAllList,(function(e,o){return[n("draggable",t._b({key:o,ref:e.ref,refInFor:!0,staticClass:"items-box",attrs:{list:e.children,group:{name:"sortable",pull:"clone",put:!1},move:t.handleFlowMoveItem,sort:!1},on:{start:t.handleFlowMoveStart,end:t.handleFlowMoveEnd}},"draggable",t.dragConfig,!1),[t._l(e.children,(function(o,i){return[e.type===t.flowTypeConstant.action?[o.hidden?t._e():n("div",{key:i,staticClass:"node",attrs:{title:o.name,"data-id":o.id,"data-type":o.type,"data-group":o.groupType}},[n("div",{staticClass:"step-img",class:o.className}),n("div",{staticClass:"step-title"},[t._v(t._s(o.name))])])]:e.type===t.flowTypeConstant.flow?[o.hidden?t._e():n("div",{key:i,staticClass:"node node-circle",attrs:{title:o.name,"data-id":o.id,"data-type":o.type,"data-group":o.groupType}},[n("div",{staticClass:"step-img",class:o.className})])]:e.type===t.flowTypeConstant.condition?[o.hidden?t._e():n("div",{key:i,staticClass:"node-square",attrs:{title:o.name,"data-id":o.id,"data-type":o.type,"data-group":o.groupType}},[n("div",{staticClass:"square"},[n("div",{staticClass:"step-img",class:o.className})])])]:t._e()]}))],2)]}))],2)]),n("el-dialog",{staticClass:"dialog-wrap",attrs:{visible:t.dialogObj.visible,"show-close":!1,width:"500px"},on:{"update:visible":function(e){return t.$set(t.dialogObj,"visible",e)}}},[t.dialogObj.editType===t.flowItemTypeConstant.list?[n("list-form",{on:{handleCheck:t.handleSelectFlowItem}})]:[n("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[t.dialogObj.editType!==t.flowItemTypeConstant.startNode?n("i",{staticClass:"el-icon-arrow-left",on:{click:t.handleGoList}}):t._e(),n("span",{staticClass:"desc"},[t._v(t._s(t.dialogObj.editType))])]),n("div",{staticClass:"dialog-body"},[t.dialogObj.editType?[n(t.dialogFlowItemComponent,{ref:"flowEditComponent",tag:"component",attrs:{editItem:t.dialogObj.editForm},on:{"update:editItem":function(e){return t.$set(t.dialogObj,"editForm",e)},"update:edit-item":function(e){return t.$set(t.dialogObj,"editForm",e)}}})]:t._e()],2)],n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini"},on:{click:t.handleCloseDialog}},[t._v("取 消")]),t.dialogObj.editType!==t.flowItemTypeConstant.list?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleTempFlowFormData}},[t._v("确 定")]):t._e()],1)],2),n("el-dialog",{attrs:{title:"JSON数据",visible:t.dialogVisible,width:"700px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[t.dialogVisible?n("div",{ref:"preShow",staticClass:"pre-show"}):t._e(),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("关 闭")])],1)])],1)},l=[],r=(n("99af"),n("7db0"),n("c740"),n("4160"),n("c975"),n("d81d"),n("a434"),n("b0c0"),n("a9e3"),n("b64b"),n("ac1f"),n("5319"),n("159b"),n("075d")),d=n.n(r),c=n("fc80"),u={action:"action",condition:"condition",flow:"flow",temp:"temp"},f={startNode:"startNode",endNode:"endNode",waitNode:"waitNode",tempNode:"tempNode",nodeNode:"nodeNode",ifNode:"ifNode",expandNode:"expandNode",list:"list"},p={action:[{id:"nodeNode",type:"nodeNode",className:"step-tag",name:"节点",groupType:"action"}],condition:[{id:"conditionNode",type:"ifNode",className:"step-if",name:"条件判断",groupType:"condition"},{id:"switchNode",type:"expandNode",className:"step-expand",name:"条件分组",groupType:"condition"}],flow:[{id:"startNode",type:"startNode",className:"step-start",name:"start",groupType:"flow",hidden:!0},{id:"stopNode",type:"endNode",className:"step-end",name:"结束",groupType:"flow"}],temp:[{id:"tempNode",type:"tempNode",className:"step-temp",name:"temp",groupType:"temp"}]},m=[{type:u.action,ref:"actionFlow",children:p.action},{type:u.flow,ref:"flowFlow",children:p.flow},{type:u.condition,ref:"conditionFlow",children:p.condition}],h=(n("d3b7"),n("25f0"),n("53ca"));function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)}))}function v(t){var e="";return"object"===Object(h["a"])(t)?(e=JSON.stringify(t),e=JSON.parse(e)):e=t,e}n("1276");var g=function(t){var e=/^\s*(.*?)\s+$/;return t.replace(e,"$1")};function b(t,e){if(t&&e){for(var n=t.className,o=(e||"").split(" "),i=0,a=o.length;i<a;i++){var s=o[i];s&&(t.classList?t.classList.add(s):x(t,s)||(n+=" "+s))}t.classList||(t.className=n)}}function I(t,e){if(t&&e){for(var n=" "+t.className+" ",o=(e||"").split(" "),i=0,a=o.length;i<a;i++){var s=o[i];s&&(t.classList?t.classList.remove(s):x(t,s)||(n=n.replace(" "+s+" "," ")))}t.classList||(t.className=g(n))}}function x(t,e){if(!t||!e)return!1;if(-1!==e.indexOf(" "))throw new Error("classNames should not contain space");return t.classList?t.classList.contains(e):(" "+t.className+" ").indexOf(" "+e+" ")>-1}function F(t,e){try{return window.getComputedStyle?window.getComputedStyle(t,null)[e]:t.currentStyle[e]}catch(n){return null}}function y(t){var e=F(t,"width");return"auto"===e&&(e=t.offsetWidth),parseFloat(e)}var N=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._l(t.flowAllList,(function(e){return[n("div",{staticClass:"items-box"},[t._l(e.children,(function(o,i){return[e.type===t.flowTypeConstant.action?[o.hidden?t._e():n("div",{staticClass:"node",on:{click:function(e){return t.handleClick(o)}}},[n("div",{staticClass:"step-img",class:o.className}),n("div",{staticClass:"step-title"},[t._v(t._s(o.name))])])]:e.type===t.flowTypeConstant.flow?[o.hidden?t._e():n("div",{staticClass:"node node-circle",on:{click:function(e){return t.handleClick(o)}}},[n("div",{staticClass:"step-img",class:o.className})])]:e.type===t.flowTypeConstant.condition?[o.hidden?t._e():n("div",{staticClass:"node-square",on:{click:function(e){return t.handleClick(o)}}},[n("div",{staticClass:"square"},[n("div",{staticClass:"step-img",class:o.className})])])]:t._e()]}))],2)]}))],2)},C=[],T={name:"ListForm",data:function(){return{flowAllList:m,flowTypeConstant:u}},methods:{handleClick:function(t){this.$emit("handleCheck",t)}}},S=T,D=(n("6523"),n("2877")),O=Object(D["a"])(S,N,C,!1,null,"1b772e52",null),$=O.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.tempItem,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"名称",prop:"stepName"}},[n("el-input",{staticStyle:{width:"200px"},attrs:{size:"small"},model:{value:t.tempItem.stepName,callback:function(e){t.$set(t.tempItem,"stepName",e)},expression:"tempItem.stepName"}})],1)],1)],1)},E=[];function L(){return{stepName:"新建"}}var j={name:"StartNodeForm",props:{editItem:{type:Object}},data:function(){return{tempItem:L(),rules:{stepName:[{required:!0,trigger:"blur",message:"请填写名称"}]}}},created:function(){this.editItem&&this.editItem.stepName&&(this.tempItem=v(this.editItem))},methods:{validateFormData:function(){var t=this;return new Promise((function(e,n){t.$refs["dataForm"].validate((function(t){t?e():n()}))}))},formData:function(){var t=v(this.tempItem);return t}}},k=j,P=Object(D["a"])(k,_,E,!1,null,"9a7d79b6",null),M=P.exports,U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.tempItem,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"名称",prop:"stepName"}},[n("el-input",{staticStyle:{width:"200px"},attrs:{size:"small"},model:{value:t.tempItem.stepName,callback:function(e){t.$set(t.tempItem,"stepName",e)},expression:"tempItem.stepName"}})],1)],1)],1)},G=[];function B(){return{stepName:"节点"}}var A={name:"nodeNodeForm",props:{editItem:{type:Object}},data:function(){return{tempItem:B(),rules:{stepName:[{required:!0,trigger:"blur",message:"请填写名称"}]}}},created:function(){this.editItem&&this.editItem.stepName&&(this.tempItem=v(this.editItem))},methods:{validateFormData:function(){var t=this;return new Promise((function(e,n){t.$refs["dataForm"].validate((function(t){t?e():n()}))}))},formData:function(){var t=v(this.tempItem);return t}}},R=A,J=Object(D["a"])(R,U,G,!1,null,"f5f0e5f8",null),V=J.exports,q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"if-node-form"},[n("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.tempItem,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"步骤名称",prop:"stepName"}},[n("el-input",{staticStyle:{width:"200px"},attrs:{size:"small"},model:{value:t.tempItem.stepName,callback:function(e){t.$set(t.tempItem,"stepName",e)},expression:"tempItem.stepName"}})],1)],1)],1)},z=[];function H(){return{stepName:"条件判断"}}var W={name:"IfNodeForm",props:{editItem:{type:Object}},created:function(){if(this.editItem&&this.editItem.stepName){var t=v(this.editItem);this.updateData(t)}this.init()},data:function(){return{tempItem:H(),rules:{stepName:[{required:!0,trigger:"blur",message:"请填写名称"}]}}},methods:{init:function(){},updateData:function(t){this.tempItem.stepName=t.stepName},validateFormData:function(){var t=this;return new Promise((function(e,n){t.$refs["dataForm"].validate((function(t){t?e():n()}))}))},formData:function(){var t=v(this.tempItem);return t}}},X=W,K=Object(D["a"])(X,q,z,!1,null,"783c604f",null),Q=K.exports,Y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.tempItem,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"步骤名称",prop:"stepName"}},[n("el-input",{staticStyle:{width:"200px"},attrs:{size:"small"},model:{value:t.tempItem.stepName,callback:function(e){t.$set(t.tempItem,"stepName",e)},expression:"tempItem.stepName"}})],1),n("el-form-item",{attrs:{label:"分支",prop:"stepName"}},[t._l(t.tempItem.ruleGroupList,(function(e,o){return[n("div",{staticClass:"expand-item"},[n("span",{staticClass:"expand-title"},[t._v("分支"+t._s(o+1)+" ")]),n("span",{staticClass:"expand-content"},[n("el-input",{attrs:{size:"small",placeholder:"placeholder"},model:{value:e.name,callback:function(n){t.$set(e,"name",n)},expression:"ruleItem.name"}})],1),n("span",{staticClass:"el-icon-btn el-icon-remove",attrs:{title:"删除分支"},on:{click:function(e){return t.handleRemoveRuleGroup(o)}}})])]})),n("div",{staticClass:"el-icon-btn rule-content-tips el-icon-circle-plus",attrs:{title:"创建分支"},on:{click:t.handleCreateRuleGroup}})],2)],1)],1)},Z=[];function tt(){return{stepName:"条件分组",ruleGroupList:[{name:""}]}}var et={name:"ExpandNodeForm",props:{editItem:{type:Object}},data:function(){return{tempItem:tt(),rules:{stepName:[{required:!0,trigger:"blur",message:"请填写名称"}]}}},created:function(){if(this.editItem&&this.editItem.stepName){var t=v(this.editItem);this.updateData(t)}},methods:{updateData:function(t){this.tempItem=t},validateFormData:function(){var t=this;return new Promise((function(e,n){t.$refs["dataForm"].validate((function(t){t?e():n()}))}))},formData:function(){var t=v(this.tempItem);return t},handleCreateRuleGroup:function(){this.tempItem.ruleGroupList.push({name:""})},handleRemoveRuleGroup:function(t){this.tempItem.ruleGroupList.splice(t,1),0===this.tempItem.ruleGroupList.length&&this.handleCreateRuleGroup()},_message:function(t,e){this.$message({type:e||"error",message:t})}}},nt=et,ot=(n("5052"),Object(D["a"])(nt,Y,Z,!1,null,"c2eb94a2",null)),it=ot.exports,at={positions:'{"f4d316b7-b2d1-46bf-aeaa-42525c84726f":{"left":801,"top":30},"c89829f5-8595-458c-b040-4ff84d27befc":{"left":801,"top":150},"7bd4fc3d-c3b9-4b19-81dc-e49cd1e7b5c5":{"left":800,"top":271},"85c30556-75fa-441c-9a1d-0dced21755a5":{"left":1246,"top":261},"23220649-1dcd-4bdc-af43-a6f80800b80c":{"left":720,"top":391},"da100cd2-a2fd-4967-911f-3acb1036d249":{"left":880,"top":391},"4829e3d8-b45a-4719-abdb-518df7e383ea":{"left":1166,"top":381},"70712f8b-d164-4224-89fd-983a9a20f6b7":{"left":1326,"top":381},"9fa174ae-97b3-41b6-a9a5-9e6189561b85":{"left":720,"top":511},"996c2224-7ae3-43fe-ba3c-8b0c33f8a632":{"left":640,"top":631},"d2a791f1-7bd7-4cde-ab7c-2e8fab3bb869":{"left":800,"top":631},"d5ba66cb-7ddb-4dbc-ad44-fe27570cc90d":{"left":640,"top":751},"89bf2095-030f-4c5f-9d52-1f97cab2e295":{"left":720,"top":871},"83e1fce2-90d8-4edc-9d72-256e2e95425c":{"left":560,"top":871},"653742e5-ea18-4808-ae09-578a3b4667de":{"left":560,"top":991},"b8cb3a6f-4235-4b73-af09-3288f6bebe66":{"left":1166,"top":501},"43c74167-9906-454f-b3d4-4b0687c9cb94":{"left":1086,"top":621},"88e3aee3-d01c-432e-af05-d79d922c55df":{"left":1246,"top":621},"35a13fb1-916e-4717-9692-96a3262e5fd4":{"left":1086,"top":741},"d1c1e591-5b3e-4128-9609-080a30d8e414":{"left":1006,"top":861},"512f2bac-82ca-4ecc-8e71-a0171e8beb4a":{"left":1166,"top":861},"ccf0d71b-a81e-47f6-80f6-ec3dfb270f9c":{"left":1006,"top":981},"bda7748f-f87d-4a04-880e-eca936d59a0e":{"left":174,"top":270},"ccd691fc-8301-404b-847a-0304a7ef7a45":{"left":-146,"top":390},"9f0a671f-5fa4-4e2b-84d0-3f157a7f5da6":{"left":14,"top":390},"cedce24b-b0bb-4e3c-bc08-d0a63794c16c":{"left":174,"top":390},"9ac93355-d562-429c-b533-f80aa73771e0":{"left":334,"top":390},"b5b80616-46db-433a-856c-176b2e53f3bb":{"left":494,"top":390}}',steps:[{elementId:"startNode",stepId:"f4d316b7-b2d1-46bf-aeaa-42525c84726f",nextStep:"c89829f5-8595-458c-b040-4ff84d27befc"},{elementId:"switchNode",stepId:"c89829f5-8595-458c-b040-4ff84d27befc",nextSteps:[{nextStep:"bda7748f-f87d-4a04-880e-eca936d59a0e",name:"1",isDefault:!1},{nextStep:"7bd4fc3d-c3b9-4b19-81dc-e49cd1e7b5c5",name:"2",isDefault:!1},{nextStep:"85c30556-75fa-441c-9a1d-0dced21755a5",name:"3",isDefault:!1}],stepName:"条件分组"},{elementId:"conditionNode",stepId:"7bd4fc3d-c3b9-4b19-81dc-e49cd1e7b5c5",nextSteps:[{nextStep:"23220649-1dcd-4bdc-af43-a6f80800b80c",name:"是",isDefault:!1,ruleGroups:[]},{nextStep:"da100cd2-a2fd-4967-911f-3acb1036d249",name:"否",isDefault:!0,ruleGroups:[]}],stepName:"条件判断",stepJson:"{}"},{elementId:"conditionNode",stepId:"85c30556-75fa-441c-9a1d-0dced21755a5",nextSteps:[{nextStep:"4829e3d8-b45a-4719-abdb-518df7e383ea",name:"是",isDefault:!1,ruleGroups:[]},{nextStep:"70712f8b-d164-4224-89fd-983a9a20f6b7",name:"否",isDefault:!0,ruleGroups:[]}],stepName:"条件判断",stepJson:"{}"},{elementId:"nodeNode",stepId:"23220649-1dcd-4bdc-af43-a6f80800b80c",nextStep:"9fa174ae-97b3-41b6-a9a5-9e6189561b85",stepName:"节点"},{elementId:"stopNode",stepId:"da100cd2-a2fd-4967-911f-3acb1036d249",nextStep:null},{elementId:"nodeNode",stepId:"4829e3d8-b45a-4719-abdb-518df7e383ea",nextStep:"b8cb3a6f-4235-4b73-af09-3288f6bebe66",stepName:"节点"},{elementId:"stopNode",stepId:"70712f8b-d164-4224-89fd-983a9a20f6b7",nextStep:null},{elementId:"conditionNode",stepId:"9fa174ae-97b3-41b6-a9a5-9e6189561b85",nextSteps:[{nextStep:"996c2224-7ae3-43fe-ba3c-8b0c33f8a632",name:"是",isDefault:!1,ruleGroups:[]},{nextStep:"d2a791f1-7bd7-4cde-ab7c-2e8fab3bb869",name:"否",isDefault:!0,ruleGroups:[]}],stepName:"条件判断",stepJson:"{}"},{elementId:"nodeNode",stepId:"996c2224-7ae3-43fe-ba3c-8b0c33f8a632",nextStep:"d5ba66cb-7ddb-4dbc-ad44-fe27570cc90d",stepName:"节点"},{elementId:"stopNode",stepId:"d2a791f1-7bd7-4cde-ab7c-2e8fab3bb869",nextStep:null},{elementId:"conditionNode",stepId:"d5ba66cb-7ddb-4dbc-ad44-fe27570cc90d",nextSteps:[{nextStep:"83e1fce2-90d8-4edc-9d72-256e2e95425c",name:"是",isDefault:!1,ruleGroups:[]},{nextStep:"89bf2095-030f-4c5f-9d52-1f97cab2e295",name:"否",isDefault:!0,ruleGroups:[]}],stepName:"条件判断",stepJson:"{}"},{elementId:"stopNode",stepId:"89bf2095-030f-4c5f-9d52-1f97cab2e295",nextStep:null},{elementId:"nodeNode",stepId:"83e1fce2-90d8-4edc-9d72-256e2e95425c",nextStep:"653742e5-ea18-4808-ae09-578a3b4667de",stepName:"节点"},{elementId:"stopNode",stepId:"653742e5-ea18-4808-ae09-578a3b4667de",nextStep:null},{elementId:"conditionNode",stepId:"b8cb3a6f-4235-4b73-af09-3288f6bebe66",nextSteps:[{nextStep:"43c74167-9906-454f-b3d4-4b0687c9cb94",name:"是",isDefault:!1,ruleGroups:[]},{nextStep:"88e3aee3-d01c-432e-af05-d79d922c55df",name:"否",isDefault:!0,ruleGroups:[]}],stepName:"条件判断",stepJson:"{}"},{elementId:"nodeNode",stepId:"43c74167-9906-454f-b3d4-4b0687c9cb94",nextStep:"35a13fb1-916e-4717-9692-96a3262e5fd4",stepName:"节点"},{elementId:"stopNode",stepId:"88e3aee3-d01c-432e-af05-d79d922c55df",nextStep:null},{elementId:"conditionNode",stepId:"35a13fb1-916e-4717-9692-96a3262e5fd4",nextSteps:[{nextStep:"d1c1e591-5b3e-4128-9609-080a30d8e414",name:"是",isDefault:!1,ruleGroups:[]},{nextStep:"512f2bac-82ca-4ecc-8e71-a0171e8beb4a",name:"否",isDefault:!0,ruleGroups:[]}],stepName:"条件判断",stepJson:"{}"},{elementId:"nodeNode",stepId:"d1c1e591-5b3e-4128-9609-080a30d8e414",nextStep:"ccf0d71b-a81e-47f6-80f6-ec3dfb270f9c",stepName:"节点"},{elementId:"stopNode",stepId:"512f2bac-82ca-4ecc-8e71-a0171e8beb4a",nextStep:null},{elementId:"stopNode",stepId:"ccf0d71b-a81e-47f6-80f6-ec3dfb270f9c",nextStep:null},{elementId:"switchNode",stepId:"bda7748f-f87d-4a04-880e-eca936d59a0e",nextSteps:[{nextStep:"ccd691fc-8301-404b-847a-0304a7ef7a45",name:"1",isDefault:!1},{nextStep:"9f0a671f-5fa4-4e2b-84d0-3f157a7f5da6",name:"2",isDefault:!1},{nextStep:"cedce24b-b0bb-4e3c-bc08-d0a63794c16c",name:"3",isDefault:!1},{nextStep:"9ac93355-d562-429c-b533-f80aa73771e0",name:"4",isDefault:!1},{nextStep:"b5b80616-46db-433a-856c-176b2e53f3bb",name:"5",isDefault:!1}],stepName:"条件分组"},{elementId:"tempNode",stepId:"ccd691fc-8301-404b-847a-0304a7ef7a45",nextStep:null},{elementId:"tempNode",stepId:"9f0a671f-5fa4-4e2b-84d0-3f157a7f5da6",nextStep:null},{elementId:"tempNode",stepId:"cedce24b-b0bb-4e3c-bc08-d0a63794c16c",nextStep:null},{elementId:"tempNode",stepId:"9ac93355-d562-429c-b533-f80aa73771e0",nextStep:null},{elementId:"tempNode",stepId:"b5b80616-46db-433a-856c-176b2e53f3bb",nextStep:null}]},st=n("e193"),lt=n("2ef0"),rt=n.n(lt),dt=[],ct={animation:0,group:"description",disabled:!1,ghostClass:"sortable-ghost"},ut=120,ft=80,pt=130,mt=30,ht=30,wt=at,vt={name:"Workflow",jsPlumb:null,data:function(){return{flowTypeConstant:u,flowItemTypeConstant:f,flowAllList:m,jsPlumbInit:!1,dialogObj:{visible:!1,editType:void 0,flowUUid:void 0,editForm:void 0,isBetween:!1,flowPreUuid:void 0,flowNextUuid:void 0},dialogVisible:!1,flowList:[],dragConfig:ct,movingFlowItem:void 0,movedFlowItem:void 0,canvasDataRoom:100,toggleGridLine:!0,toggleAutoSort:!0,canUndo:!1,tempLayerMap:[]}},components:{Draggable:c["a"],ListForm:$,StartNodeForm:M,NodeNodeForm:V,IfNodeForm:Q,ExpandNodeForm:it},mounted:function(){this.$options.jsPlumb=st["jsPlumb"].getInstance(),this.initJsPlumb(),wt.steps.length>0?this.updateFlow(wt,this.$_updatePositionByAutoSort):this.initFlow()},computed:{dialogFlowItemComponent:function(){return this.dialogObj.editType+"Form"},canvasRoomMinusEnable:function(){return this.canvasDataRoom>50},canvasRoomPlusEnable:function(){return this.canvasDataRoom<100},canvasRoomScaleStyle:function(){return{transform:"scale("+this.canvasDataRoom/100+")"}},toggleGridLineClass:function(){return this.toggleGridLine?"icon-wangge-open":"icon-wangge-close"},toggleSortClass:function(){return this.toggleAutoSort?"icon-auto-sort-open":"icon-auto-sort-close"}},methods:{initFlow:function(){var t=this.createFlowItem(f.startNode);this.addTempFlowItem(t)},updateFlow:function(t,e){var n=this,o=JSON.parse(t.positions),i=t.steps,a=[];i.forEach((function(t){var e=n.getFlowItemById(t.elementId);if(e){e.next=[],e.prev=[],e.uuid=t.stepId;var i=o[t.stepId];if(i&&(e.left=i.left,e.top=i.top),t.nextStep?e.next=[t.nextStep]:t.nextSteps&&(e.next=t.nextSteps.map((function(t){return t.nextStep}))),e.type!==f.endNode)if(n.isIfFlowItem(e.type)){var s=v(t.nextSteps[0]);if(s.stepName=t.stepName,e.formData=n.getFlowItemFormData(s),s.isDefault?(e.nextElseId=s.nextStep,e.nextIfId=t.nextSteps[1].nextStep):(e.nextIfId=s.nextStep,e.nextElseId=t.nextSteps[1].nextStep),t.stepJson){var l=JSON.parse(t.stepJson);e.formData.ifNodeTitle=l.ifNodeTitle}}else if(n.isExpandFlowItem(e.type)){var r=t.nextSteps,d={};d.stepName=t.stepName,d.ruleGroupList=r,e.formData=d}else e.formData=n.getFlowItemFormData(t);a.push(e)}})),a.forEach((function(t){t.next.length>0&&t.next.forEach((function(e){var n=rt.a.find(a,(function(t){return t.uuid===e}));n&&-1===n.prev.indexOf(t.uuid)&&n.prev.push(t.uuid)}))})),a.forEach((function(t){if(n.isIfFlowItem(t.type)){var e=rt.a.find(a,(function(e){return e.uuid===t.nextIfId})),o=rt.a.find(a,(function(e){return e.uuid===t.nextElseId}));e.left<o.left?t.next=[e.uuid,o.uuid]:t.next=[o.uuid,e.uuid]}else if(n.isExpandFlowItem(t.type)){var i=t.next.map((function(t){return rt.a.find(a,(function(e){return e.uuid===t}))}));i.sort((function(t,e){return t.left-e.left})),t.next=i.map((function(t){return t.uuid}))}})),this.flowList=a,this.$nextTick((function(){a.forEach((function(t){n.$options.jsPlumb.draggable(t.uuid,{})})),n.$nextTick((function(){a.forEach((function(t){t.next.forEach((function(e,o){var i=n.getFlow(e);if(n.isTempFlowItem(i)?n.draggableFlowConnect(t.uuid,e,!0):n.addFlowItemConnect(t.uuid,e),n.isIfFlowItem(t.type)){var a=t.nextIfId===i.uuid;n.createFlowItemLabel(t.uuid,e,a?"是":"否")}else if(n.isExpandFlowItem(t.type)){var s=n.getExpandFlowItemName(t,e);n.createFlowItemLabel(t.uuid,e,s)}}))})),n.$nextTick((function(){e&&e()}))}))}))},$_updateMemoryList:function(){var t=this.formatData();dt.length>10&&dt.shift(),dt.push(t),this.$_updateCanUndoBtn()},$_sortFlowItemNext:function(t){var e=this,n=this.getFlow(t.prev[0]);if(this.isExpandFlowItem(n.type)){var o=n.next.map((function(t){return e.getFlow(t)}));o.sort((function(t,e){return t.left-e.left})),n.next=o.map((function(t){return t.uuid}))}else if(this.isIfFlowItem(n.type)){var i=this.getFlow(n.nextIfId),a=this.getFlow(n.nextElseId);i.left<a.left?n.next=[i.uuid,a.uuid]:n.next=[a.uuid,i.uuid]}},$_updateCanUndoBtn:function(){this.canUndo=dt.length>0},initJsPlumb:function(){var t=this;this.$options.jsPlumb.ready((function(){t.jsPlumbInit=!0,t.$options.jsPlumb.importDefaults({ConnectionsDetachable:!1,LogEnabled:!0})}))},createFlowConnectionLabel:function(t,e){var n=this;Array.isArray(t)||(t=[t]),t.forEach((function(t){var o=n.$options.jsPlumb.getConnections({source:t,target:e});o.forEach((function(t){t.getOverlay("nodeTempSmall").setVisible(!0),t.bind("click",n.handleFlowLabelClick)}))}))},createFlowItemLabel:function(t,e,n){var o=this;this.$nextTick((function(){var i=o.$options.jsPlumb.getConnections({source:t,target:e});i.length>0&&i[0].getOverlay("flowItemDesc").setLabel('<span class="node-item-title" title="'.concat(n,'">').concat(n,"</span>"))}))},removeFlowConnection:function(t,e){var n=this,o=this.$options.jsPlumb.getConnections({source:t,target:e});o.forEach((function(t){n.$options.jsPlumb.deleteConnection(t)}))},handleFlowLabelClick:function(t){var e=t.component;if(e){var n=e.sourceId,o=e.targetId;this.showDialog({isBetween:!0,flowPreUuid:n,flowNextUuid:o})}},handleEditFlowItem:function(t,e){var n=e.currentTarget;"true"===n.dataset.isClick&&this.showDialog({flowItemType:t.type,flowUuid:t.uuid,flowFormData:t.formData})},draggableFlowConnect:function(t,e,n){var o=this;function i(){o.jsPlumbInit&&o.$options.jsPlumb.connect({source:t,target:e,endpoint:"Dot",connectorStyle:{strokeStyle:"#ccc",joinStyle:"round",outlineColor:"#ccc"},connector:["Flowchart",{stub:[10,20],gap:1,cornerRadius:2,alwaysRespectStubs:!0}],endpointStyle:{fill:"transparent",outlineStroke:"transparent",outlineWidth:2},paintStyle:{stroke:"lightgray",strokeWidth:2},anchor:["BottomCenter","TopCenter"],overlays:[["PlainArrow",{width:10,length:10,location:1}],["Custom",{location:.5,id:"nodeTempSmall",create:function(){var n=o.$refs[e][0].$el;return n.dataset.target=e,n.dataset.source=t,n},visible:!1}],["Label",{location:1,id:"flowItemDesc",cssClass:"node-item-label",visible:!0}]]})}n?i():this.$nextTick((function(){i()}))},getFlowItemInitLeft:function(){var t=this.$refs.campaignCanvas,e=y(t),n=500;return e&&(n=e/2),n},createFlowItem:function(t,e,n){var o=this;n=n||{};var i=w(),a=this.getFlowItemByType(t),s=[];if(a){if(a.prev=[],a.next=[],a.formData={},a.left=this.getFlowItemInitLeft(),a.top=ht,a.uuid=i,e&&(Array.isArray(e)||(e=[e]),a.prev=e,e.forEach((function(t){var e=rt.a.find(o.flowList,(function(e){return e.uuid===t}));e&&(s.push(e),-1===e.next.indexOf(i)&&(rt.a.isUndefined(n.index)||-1===n.index?e.next.push(i):e.next.splice(n.index,0,i)))}))),s.length>0&&1===s.length){var l=s[0];n.offsetLeft?a.left=l.left+n.offsetLeft:n.left?a.left=n.left:a.left=l.left,a.top=l.top+ut}this.flowList.push(a),this.$nextTick((function(){o.$options.jsPlumb.draggable(i,{})}))}return a?i:null},updateFlowItem:function(t,e){var n=this.getFlow(e),o=this.getFlowItemByType(t);for(var i in o)n[i]=o[i];return n},deleteFlowItem:function(t){if(this.isOnePreOneNext(t)||this.isEndFlowItem(t)){var e=this.getFlowIndex(t.uuid);this.handleDeleteOnePrevOneNextFlowItem(t,e)}else if(this.isHasMoreNextFlowItem(t)){this.deleteNextFlowItem(t.uuid);var n=this.getFlow(t.prev[0]);if(this.isIfFlowItem(n.type))this.addIfOneTempFlowItem(n.uuid,n.nextIfId===t.uuid);else if(this.isExpandFlowItem(n.type)){var o=this.getExpandFlowItem(n,t.uuid);this.addExpandOneTempFlowItem(n,t.left,o.name)}else this.addTempFlowItem(t.prev[0])}},handleDeleteOnePrevOneNextFlowItem:function(t,e){var n=[],o=[],i=this.flowList[e];this.flowList.forEach((function(e){e.prev.length>0&&-1!==e.prev.indexOf(t.uuid)?o.push(e):e.next.length>0&&-1!==e.next.indexOf(t.uuid)&&n.push(e)}));var a={};t.type===f.endNode&&n[0].type===f.expandNode&&(a=this.getExpandFlowItem(n[0],t.uuid)),o.forEach((function(e){var n=e.prev.indexOf(t.uuid);e.prev.splice(n,1)})),n.forEach((function(e){var n=e.next.indexOf(t.uuid);e.next.splice(n,1)})),this.$options.jsPlumb.removeAllEndpoints(t.uuid,!0),this.flowList.splice(e,1),this.$nextTick((function(){var e=this,s=n[0],l=o[0];if(s&&l)if(s.next.push(l.uuid),l.prev.push(s.uuid),this.draggableFlowConnect(s.uuid,l.uuid,!0),l.type!==f.tempNode&&this.createFlowConnectionLabel(s.uuid,l.uuid),this.isIfFlowItem(s.type)){var r=s.nextIfId===t.uuid;r?s.nextIfId=l.uuid:s.nextElseId=l.uuid,this.createFlowItemLabel(s.uuid,l.uuid,r?"是":"否")}else if(this.isExpandFlowItem(s.type)){var d=this.getExpandFlowItem(s,i.uuid);d&&(d.nextStep=l.uuid),this.createFlowItemLabel(s.uuid,l.uuid,d.name)}if(t.type===f.endNode&&s)if(this.isIfFlowItem(s.type)){var c=s.nextIfId===t.uuid;this.addIfOneTempFlowItem(s.uuid,c)}else if(this.isExpandFlowItem(s.type)){var u=this.addExpandOneTempFlowItem(s,t.left,a.name);a.nextStep=u}else this.addTempFlowItem(s.uuid);this.$nextTick((function(){l&&(e.moveFlowItem(l.uuid),e.$_plumbRepaintEverything())}))}))},$_plumbRepaintEverything:function(){var t=this;this.$nextTick((function(){t.$options.jsPlumb.repaintEverything(!0)}))},getFlowItemById:function(t){var e=null;return Object.keys(p).forEach((function(n){var o=p[n];if(o&&o.length>0){var i=rt.a.find(o,(function(e){return e.id===t}));i&&(e=v(i))}})),e},getFlowItemByType:function(t){var e=null;return Object.keys(p).forEach((function(n){var o=p[n];if(o&&o.length>0){var i=rt.a.find(o,(function(e){return e.type===t}));i&&(e=v(i))}})),e},handleFlowMoveItem:function(t){var e=t.to,n=t.dragged;if(n.dataset.id===f.startNode)return!1;this.movedFlowItem?this.movedFlowItem&&this.movedFlowItem!==e&&(I(this.movedFlowItem,"is-active"),this.movedFlowItem=e,b(e,"is-active")):(this.movedFlowItem=e,b(e,"is-active"))},handleDeleteFlowItem:function(t){var e=this;this.$confirm("确定要删除吗？Tips: ifNode 和 expandNode 会删除下面所有节点","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$_updateMemoryList(),e.deleteFlowItem(t),e.$_updatePositionByAutoSort()})).catch((function(t){console.warn(t)}))},handleFlowMoveStart:function(t){var e=t.item,n=e.dataset;this.movingFlowItem={group:n.group,type:n.type}},handleFlowMoveEnd:function(t){var e=t.originalEvent;if(this.movedFlowItem){if(I(this.movedFlowItem,"is-active"),e.toElement!==this.movedFlowItem)return this.movedFlowItem=void 0,void(this.movingFlowItem=void 0);var n={flowItemType:this.movingFlowItem.type,flowUuid:this.movedFlowItem.id};this.movedFlowItem.dataset.source&&this.movedFlowItem.dataset.target&&(n.isBetween=!0,n.flowPreUuid=this.movedFlowItem.dataset.source,n.flowNextUuid=this.movedFlowItem.dataset.target,delete n.flowUuid),this.showDialog(n)}this.movedFlowItem=void 0,this.movingFlowItem=void 0},handleSelectFlowItem:function(t){var e=this;if(t.type!==f.endNode)this.showDialog({flowItemType:t.type,flowUuid:this.dialogObj.flowUUid});else{if(this.$_updateMemoryList(),this.dialogObj.isBetween){var n=this.dialogObj.flowPreUuid,o=this.dialogObj.flowNextUuid,i=this.getFlow(n),a={};if(this.isHasMoreNextFlowItemByType(i.type)){var s=this.getFlow(o);a.left=s.left}this.deleteNextFlowItem(o),this.$nextTick((function(){var o=e.addTempFlowItem(n,a);e.$nextTick((function(){e.handleAddFlowItem(t.type,o)}))}))}else this.handleAddFlowItem(t.type,this.dialogObj.flowUUid);this.initDialog()}},handleAddFlowItem:function(t,e){var n=this.updateFlowItem(t,e);if(this.createFlowConnectionLabel(n.prev,n.uuid),this.isOnePreOneNext(n))this.addTempFlowItem(e);else if(n.groupType===u.condition){var o=this.getFlow(n.prev[0]);if(this.isIfFlowItem(t))this.isIfFlowItem(o.type)&&(o.nextIfId===n.uuid?n.left-=mt:o.nextElseId===n.uuid&&(n.left+=mt)),this.addIfTempFlowItem(e);else if(this.isExpandFlowItem(t)){if(this.isIfFlowItem(o.type)){var i=n.formData.ruleGroupList.length,a=i%2===0,s=parseInt(i/2,10),l=(a?s:s+1)*ft+mt;o.nextIfId===n.uuid?n.left-=l:o.nextElseId===n.uuid&&(n.left+=l)}this.addExpandTempFlowItem(e,n.formData.ruleGroupList)}}return n},handleUpdateFlowItem:function(t){var e=this,n=t.flowItemType,o=t.tempFlowId,i=this.getFlow(o),a=!1,s=this.updateFlowItem(n,o);if(n!==i.type)this.isHasMoreNextFlowItem(i)&&(a=!0,i.next.forEach((function(t){e.deleteNextFlowItem(t)}))),this.isIfFlowItem(n)?this.handleUpdateIfFlowItem(s):this.isExpandFlowItem(n)?this.handleUpdateExpandFlowItem(s):a&&this.addTempFlowItem(s.uuid);else if(this.isExpandFlowItem(n)){var l=s.formData.ruleGroupList,r=s.next,d=[],c=[],u=[];if(l.forEach((function(t){var n=t.nextStep;n?(d.push(n),e.createFlowItemLabel(s.uuid,n,t.name)):c.push(t)})),u=rt.a.difference(r,d),u.length>0&&(s.next=d,u.forEach((function(t){e.deleteNextFlowItem(t)}))),c.length>0){var p=0;s.next.forEach((function(t){var n=e.getFlow(t);p<n.left&&(p=n.left)})),c.forEach((function(t,n){var o=p+(n+1)*(2*ft),i=e.createFlowItem(f.tempNode,s.uuid,{left:o});e.draggableFlowConnect(s.uuid,i),e.createFlowItemLabel(s.uuid,i,t.name),t.nextStep=i}))}}},handleUpdateIfFlowItem:function(t){var e=this;t.next.forEach((function(t){e.deleteNextFlowItem(t)})),this.$nextTick((function(){e.addIfTempFlowItem(t.uuid)}))},handleUpdateExpandFlowItem:function(t){var e=this;t.next.forEach((function(t){e.deleteNextFlowItem(t)})),this.$nextTick((function(){e.addExpandTempFlowItem(t.uuid,t.formData.ruleGroupList)}))},handleAddBetweenFlowItem:function(t){var e=this,n=t.flowItemType,o=t.preFlowId,i=t.nextFlowId,a=t.formData;if(this.isHasMoreNextFlowItemByType(n)){var s={},l=this.getFlow(o),r=this.isExpandFlowItem(l.type),d=r?l.formData:null;if(this.isHasMoreNextFlowItemByType(l.type)){var c=this.getFlow(i);s.left=c.left,s.index=l.next.indexOf(i)}this.deleteNextFlowItem(i),this.$nextTick((function(){var t=e.addTempFlowItem(o,s),c=e.getFlow(t);c.formData=a,e.$nextTick((function(){if(e.handleAddFlowItem(n,t),r){e.updateExpandFlowItemRuleGroup(d.ruleGroupList,i,t);var a=e.getExpandFlowItemName(l,t);e.createFlowItemLabel(o,t,a),e.$_plumbRepaintEverything()}e.$_updatePositionByAutoSort()}))}))}else this.handleAddBetweenCommonFlowItem(t)},handleAddBetweenCommonFlowItem:function(t){var e=this,n=t.flowItemType,o=t.preFlowId,i=t.nextFlowId,a=t.formData,s=this.getFlow(o),l=this.getFlow(i),r={};this.isHasMoreNextFlowItemByType(s.type)&&(r.left=l.left);var d=this.createFlowItem(n,o,r),c=this.getFlow(d);c.formData=a,c.next.push(i),this.$nextTick((function(){if(e.isExpandFlowItem(s.type)){e.updateExpandFlowItemRuleGroup(s.formData.ruleGroupList,i,d),e.updateBetweenFlowItem(d,i,o);var t=e.getExpandFlowItemName(s,d);e.createFlowItemLabel(o,d,t)}else e.updateBetweenFlowItem(d,i,o),e.isIfFlowItem(s.type)&&e.createFlowItemLabel(o,d,r.offsetLeft>0?"是":"否`");e.$_updatePositionByAutoSort()}))},getExpandFlowItemName:function(t,e){var n=this.getExpandFlowItem(t,e),o="";return n&&(o=n.name),o},updateExpandFlowItemRuleGroup:function(t,e,n){var o=rt.a.find(t,(function(t){return t.nextStep===e}));o&&(o.nextStep=n)},getExpandFlowItem:function(t,e){var n=t.formData.ruleGroupList,o=rt.a.find(n,(function(t){return t.nextStep===e}));return o},updateBetweenFlowItem:function(t,e,n){var o=this.getFlow(n),i=o.next.indexOf(e);-1!==i&&o.next.splice(i,1);var a=o.next.indexOf(t);-1===a?o.next.splice(i,0,t):a!==i&&(o.next.splice(a,1),o.next.splice(i,0,t));var s=this.getFlow(e);s.prev=[t],this.removeFlowConnection(n,e),this.addFlowItemConnect(n,t),this.addFlowItemConnect(t,e),this.moveFlowItem(e),this.$_plumbRepaintEverything()},moveFlowItem:function(t){var e=this,n=this.getFlow(t);if(n.prev.length>0){var o=this.getFlow(n.prev[0]);n.top=o.top+ut}n.next.forEach((function(t){e.moveFlowItem(t)}))},deleteNextFlowItem:function(t){var e=this,n=this.getFlow(t),o=this.getFlowIndex(t);if(n){var i=this.getFlow(n.prev[0]),a=i.next.indexOf(t);-1!==a&&i.next.splice(a,1),this.flowList.splice(o,1),this.$nextTick((function(){e.$options.jsPlumb.removeAllEndpoints(n.uuid)})),n.next.forEach((function(t){e.deleteNextFlowItem(t)}))}},getFlow:function(t){var e=rt.a.find(this.flowList,(function(e){return e.uuid===t}));return e},getFlowIndex:function(t){var e=rt.a.findIndex(this.flowList,(function(e){return e.uuid===t}));return e},addTempFlowItem:function(t,e){var n=this.createFlowItem(f.tempNode,t,e);return this.draggableFlowConnect(t,n),n},addIfTempFlowItem:function(t){this.addIfOneTempFlowItem(t,!0),this.addIfOneTempFlowItem(t,!1)},addIfOneTempFlowItem:function(t,e){var n=this.getFlow(t),o=e?-ft:ft,i=this.createFlowItem(f.tempNode,t,{offsetLeft:o});return this.draggableFlowConnect(t,i),this.createFlowItemLabel(t,i,e?"是":"否"),e?n.nextIfId=i:n.nextElseId=i,i},addExpandTempFlowItem:function(t,e){var n,o=e.length,i=o%2===0,a=parseInt(o/2,10);a=i?a-1:a;for(var s={},l=0;l<=a;l++){n=e[l];var r=a-l,d=r*(2*ft);i&&(d+=ft),s.offsetLeft=-d;var c=this.createFlowItem(f.tempNode,t,s);this.draggableFlowConnect(t,c),this.createFlowItemLabel(t,c,n.name),n.nextStep=c}for(var u=a+1;u<o;u++){n=e[u];var p=i?u-(a+1):u-a,m=p*(2*ft);i&&(m+=ft),s.offsetLeft=m;var h=this.createFlowItem(f.tempNode,t,s);this.draggableFlowConnect(t,h),this.createFlowItemLabel(t,h,n.name),n.nextStep=h}},addExpandOneTempFlowItem:function(t,e,n){var o=this.createFlowItem(f.tempNode,t.uuid,{left:e});return this.draggableFlowConnect(t.uuid,o),this.createFlowItemLabel(t.uuid,o,n),o},addFlowItemConnect:function(t,e){this.draggableFlowConnect(t,e,!0),this.createFlowConnectionLabel(t,e)},handleChangeFlowPosition:function(t,e){var n=e.currentTarget,o=n.dataset.firstTime,i=(new Date).getTime(),a=(""+n.style.left).replace("px",""),s=(""+n.style.top).replace("px",""),l=i-o<200;l||this.$_updateMemoryList(),t.left=Number(a),t.top=Number(s),l||this.$_sortFlowItemNext(t),n.dataset.isClick=l},handleFlowMoveDown:function(t){var e=t.currentTarget;e.dataset.firstTime=(new Date).getTime()},handleTempFlowFormData:function(){var t=this,e=this.$refs.flowEditComponent;e&&e.validateFormData&&e.validateFormData().then((function(){var n=e.formData();if(t.$_updateMemoryList(),t.dialogObj.isBetween)t.handleAddBetweenFlowItem({flowItemType:t.dialogObj.editType,preFlowId:t.dialogObj.flowPreUuid,nextFlowId:t.dialogObj.flowNextUuid,formData:n});else{var o=t.getFlow(t.dialogObj.flowUUid);o.formData=n,o.type===f.tempNode?(t.handleAddFlowItem(t.dialogObj.editType,o.uuid),t.$_updatePositionByAutoSort()):t.handleUpdateFlowItem({flowItemType:t.dialogObj.editType,tempFlowId:o.uuid})}t.initDialog()})).catch((function(){}))},handleCloseDialog:function(){this.initDialog()},handleGoList:function(){this.dialogObj.editType=f.list},showDialog:function(t){if(t.isBetween)this.dialogObj.isBetween=!0,this.dialogObj.flowPreUuid=t.flowPreUuid,this.dialogObj.flowNextUuid=t.flowNextUuid,this.dialogObj.editType=t.flowItemType||f.list;else{if(t.flowItemType===f.endNode)return void this.handleAddFlowItem(t.flowItemType,t.flowUuid);this.dialogObj.editType=t.flowItemType,this.dialogObj.flowUUid=t.flowUuid,t.flowFormData&&(this.dialogObj.editForm=t.flowFormData),t.flowItemType===f.tempNode&&(this.dialogObj.editType=f.list)}this.dialogObj.visible=!0},initDialog:function(){this.dialogObj.visible=!1,this.dialogObj.flowUUid=void 0,this.dialogObj.editType=void 0,this.dialogObj.isBetween=!1,this.dialogObj.flowPreUuid=void 0},formatData:function(){var t=this,e={},n={},o=[],i=v(this.flowList);return i.forEach((function(e){e.type===f.startNode&&e.formData.stepName;var i={elementId:e.id,stepId:e.uuid};if(e.next.length>1)if(t.isIfFlowItem(e.type)){var a=e.formData.ruleGroups||[],s={nextStep:e.nextIfId,name:"是",isDefault:!1,ruleGroups:a},l={nextStep:e.nextElseId,name:"否",isDefault:!0,ruleGroups:[]};i.nextSteps=[s,l],i.stepName=e.formData.stepName,i.stepJson=JSON.stringify({ifNodeTitle:e.formData.ifNodeTitle})}else if(t.isExpandFlowItem(e.type)){var r=e.formData.ruleGroupList,d=[];r.forEach((function(t){var e={nextStep:t.nextStep,name:t.name,ruleGroups:t.ruleGroups,isDefault:!!t.isDefault};d.push(e)})),i.nextSteps=d,i.stepName=e.formData.stepName}else i.nextSteps=e.next.map((function(t){return{nextStep:t}}));else i.nextStep=e.next[0]||null;t.isIfFlowItem(e.type)||t.isExpandFlowItem(e.type)||(i=Object.assign(i,e.formData)),o.push(i),n[e.uuid]={left:e.left,top:e.top}})),e.positions=JSON.stringify(n),e.steps=o,e},handleMinusCanvas:function(){this.canvasDataRoom<=50||(this.canvasDataRoom=this.canvasDataRoom-10)},handlePlusCanvas:function(){100!==this.canvasDataRoom&&(this.canvasDataRoom=this.canvasDataRoom+10)},handleSort:function(){this.$_updatePosition()},handleClear:function(){var t=this;this.$confirm("确定要清空数据,重做吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$_doClear(!0)})).catch((function(){}))},handleToggleAutoSort:function(){this.toggleAutoSort=!this.toggleAutoSort,this.$_updatePositionByAutoSort()},$_updatePositionByAutoSort:function(){var t=this;this.toggleAutoSort&&this.$nextTick((function(){t.$_updatePosition()}))},handleUndo:function(){var t=this;if(this.canUndo){if(dt.length>0){var e=dt.pop();this.$_doClear(),this.$options.jsPlumb.reset(),this.$nextTick((function(){t.updateFlow(e,t.$_plumbRepaintEverything)}))}this.$_updateCanUndoBtn()}},$_updatePosition:function(){var t=this;console.log("$_updatePosition"),this.tempLayerMap=[];var e=rt.a.find(this.flowList,(function(e){return t.isStartFlowItem(e)}));e.top=ht,e.left=this.getFlowItemInitLeft(),this.tempLayerMap[0]=[e],this.$_layoutChild(e,1),this.$_adjustChild();var n=this.$_getFirstLeft();if(n<0){var o=-n;this.$_offsetFlowListLeft(o)}this.$_plumbRepaintEverything()},$_getFirstLeft:function(){var t=this.flowList[0].left;return this.flowList.forEach((function(e){t>e.left&&(t=e.left)})),t},$_offsetFlowListLeft:function(t){this.flowList.forEach((function(e){e.left+=t}))},$_updateOneFlowPosition:function(t){this.isHasMoreNextFlowItemByType(t.type)},$_adjustChild:function(){for(var t=this,e=null,n=this.tempLayerMap.length-1;n>=0;n--)e=this.tempLayerMap[n],e.forEach((function(o,i){var a=e[i-1];if(a&&o.left-a.left<pt){var s=t.$_findCommonParentNode(a,o),l=Math.abs(o.left-a.left)+pt;t.$_translateXTree(s,l);var r=t.getFlow(s.prev[0]);t.$_centerChild(r),n=t.tempLayerMap.length}}))},$_centerChild:function(t){var e=this,n=0;if(t.next&&t.next.length>0){if(1===t.next.length){var o=this.getFlow(t.next[0]);n=t.left-o.left}else{var i=this.getFlow(t.next[0]),a=this.getFlow(t.next[t.next.length-1]);n=t.left-(i.left+(a.left-i.left)/2)}n&&t.next.forEach((function(t){var o=e.getFlow(t);o&&e.$_translateXTree(o,n)}))}},$_translateXTree:function(t,e){var n=this;t.left+=e,t.next&&t.next.length>0&&t.next.forEach((function(t){var o=n.getFlow(t);o&&n.$_translateXTree(o,e)}))},$_findCommonParentNode:function(t,e){if(t.prev[0]===e.prev[0])return e;var n=this.getFlow(t.prev[0]),o=this.getFlow(e.prev[0]);return this.$_findCommonParentNode(n,o)},$_layoutChild:function(t,e){var n=this,o=t.next,i=o.length;void 0===this.tempLayerMap[e]&&(this.tempLayerMap[e]=[]),o.forEach((function(o,a){var s=n.getFlow(o);if(s){s.top=t.top+ut;var l=t.left-pt*(i-1)/2;s.left=l+pt*a,n.tempLayerMap[e].push(s),s.next&&s.next.length>0&&n.$_layoutChild(s,e+1)}}))},$_doClear:function(t){var e=this,n=rt.a.find(this.flowList,(function(t){return e.isStartFlowItem(t)}));n&&(this.deleteNextFlowItem(n.uuid),t&&this.$nextTick((function(){e.initFlow()})))},handleGetData:function(){var t=this,e=this.formatData();console.log("formData",JSON.stringify(e));var n=new d.a(e,3);this.dialogVisible=!0,this.$nextTick((function(){t.$refs.preShow.appendChild(n.render())}))},getFlowItemFormData:function(t){var e=v(t);return delete e.elementId,delete e.stepId,e.nextStep&&delete e.nextStep,e.nextSteps&&delete e.nextSteps,e},_message:function(t,e){this.$message({type:e||"error",message:t})},isOnePreOneNext:function(t){return t.groupType===u.action||t.type===f.waitNode},isTempFlowItem:function(t){return t.type===f.tempNode},isStartFlowItem:function(t){return t.type===f.startNode},isEndFlowItem:function(t){return t.type===f.endNode},isIfFlowItem:function(t){return t===f.ifNode},isExpandFlowItem:function(t){return t===f.expandNode},isHasMoreNextFlowItem:function(t){return this.isHasMoreNextFlowItemByType(t.type)},isHasMoreNextFlowItemByType:function(t){return this.isIfFlowItem(t)||this.isExpandFlowItem(t)},isHasStepCountFlowItem:function(t){return t.groupType===u.action||t.type===f.startNode}}},gt=vt,bt=(n("d4ee"),Object(D["a"])(gt,s,l,!1,null,null,null)),It=bt.exports,xt={name:"App",components:{Workflow:It}},Ft=xt,yt=Object(D["a"])(Ft,i,a,!1,null,null,null),Nt=yt.exports,Ct=n("5c96"),Tt=n.n(Ct);n("0fae");o["default"].config.productionTip=!1,o["default"].use(Tt.a),new o["default"]({render:function(t){return t(Nt)}}).$mount("#app")},6523:function(t,e,n){"use strict";var o=n("ff6f"),i=n.n(o);i.a},"83c4":function(t,e,n){},b37d:function(t,e,n){},d4ee:function(t,e,n){"use strict";var o=n("83c4"),i=n.n(o);i.a},fc80:function(t,e,n){"use strict";(function(t){n("99af"),n("4de4"),n("4160"),n("caad"),n("c975"),n("d81d"),n("a434");var o=n("2909"),i=n("53fe");function a(){return"undefined"!==typeof window?window.console:t.console}var s=a();function l(t,e,n){return void 0==n||(t=null==t?{}:t,t[e]=n),t}function r(t){null!==t.parentElement&&t.parentElement.removeChild(t)}function d(t,e,n){var o=0===n?t.children[0]:t.children[n-1].nextSibling;t.insertBefore(e,o)}function c(t,e){return t.map((function(t){return t.elm})).indexOf(e)}function u(t,e,n){if(!t)return[];var i=t.map((function(t){return t.elm})),a=Object(o["a"])(e).map((function(t){return i.indexOf(t)}));return n?a.filter((function(t){return-1!==t})):a}function f(t,e){var n=this;this.$nextTick((function(){return n.$emit(t.toLowerCase(),e)}))}function p(t){var e=this;return function(n){null!==e.realList&&e["onDrag"+t](n),f.call(e,t,n)}}function m(t){if(!t)return!1;var e=t.pull;return"function"===typeof e?"clone"===e():"clone"===e}var h=["Start","Add","Remove","Update","End"],w=["Choose","Sort","Filter","Clone"],v=["Move"].concat(h,w).map((function(t){return"on"+t})),g=null,b={options:Object,list:{type:Array,required:!1,default:null},value:{type:Array,required:!1,default:null},noTransitionOnDrag:{type:Boolean,default:!1},clone:{type:Function,default:function(t){return t}},element:{type:String,default:"div"},tag:{type:String,default:null},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},I={name:"draggable",inheritAttrs:!0,props:b,data:function(){return{transitionMode:!1,noneFunctionalComponentMode:!1,init:!1,isCloning:!1}},render:function(t){var e=this.$slots.default;if(e&&1===e.length){var n=e[0];n.componentOptions&&["transition-group","TransitionGroup"].includes(n.componentOptions.tag)&&(this.transitionMode=!0)}var i=0,a=e,s=this.$slots,r=s.header,d=s.footer;r&&(i=r.length,a=a?[].concat(Object(o["a"])(r),Object(o["a"])(a)):Object(o["a"])(r)),d&&(a=a?[].concat(Object(o["a"])(a),Object(o["a"])(d)):Object(o["a"])(d)),this.headerOffset=i;var c=null,u=function(t,e){c=l(c,t,e)};if(this.componentData){var f=this.componentData,p=f.on,m=f.props;u("on",p),u("props",m)}return t(this.getTag(),c,a)},created:function(){null!==this.list&&null!==this.value&&s.error("Value and list props are mutually exclusive! Please set one or another."),"div"!==this.element&&s.warn("Element props is deprecated please use tag props instead. See https://github.com/SortableJS/Vue.Draggable/blob/master/documentation/migrate.md#element-props"),void 0!==this.options&&s.warn("Options props is deprecated, add sortable options directly as vue.draggable item, or use v-bind. See https://github.com/SortableJS/Vue.Draggable/blob/master/documentation/migrate.md#options-props")},mounted:function(){var t=this;if(this.noneFunctionalComponentMode=this.getTag().toLowerCase()!==this.$el.nodeName.toLowerCase(),this.noneFunctionalComponentMode&&this.transitionMode)throw new Error("Transition-group inside component is not supported. Please alter tag value or remove transition-group. Current tag value: ".concat(this.getTag()));var e={};h.forEach((function(n){e["on"+n]=p.call(t,n)})),w.forEach((function(n){e["on"+n]=f.bind(t,n)}));var n=Object.assign({},this.options,this.$attrs,e,{onMove:function(e,n){return t.onDragMove(e,n)}});!("draggable"in n)&&(n.draggable=">*"),this._sortable=new i(this.rootContainer,n),this.computeIndexes()},beforeDestroy:function(){void 0!==this._sortable&&this._sortable.destroy()},computed:{rootContainer:function(){return this.transitionMode?this.$el.children[0]:this.$el},realList:function(){return this.list?this.list:this.value}},watch:{options:{handler:function(t){this.updateOptions(t)},deep:!0},$attrs:{handler:function(t){this.updateOptions(t)},deep:!0},realList:function(){this.computeIndexes()}},methods:{getTag:function(){return this.tag||this.element},getIsCloning:function(){var t=this.$attrs.group,e=t||this.getOptionGroup();return m(e)},getOptionGroup:function(){var t=this.options;if(t)return t.group},updateOptions:function(t){for(var e in t)-1==v.indexOf(e)&&this._sortable.option(e,t[e])},getChildrenNodes:function(){if(this.init||(this.noneFunctionalComponentMode=this.noneFunctionalComponentMode&&1==this.$children.length,this.init=!0),this.noneFunctionalComponentMode)return this.$children[0].$slots.default;var t=this.$slots.default;return this.transitionMode?t[0].child.$slots.default:t},computeIndexes:function(){var t=this;this.$nextTick((function(){t.visibleIndexes=u(t.getChildrenNodes(),t.rootContainer.children,t.transitionMode)}))},getUnderlyingVm:function(t){var e=c(this.getChildrenNodes()||[],t);if(-1===e)return null;var n=this.realList[e];return{index:e,element:n}},getUnderlyingPotencialDraggableComponent:function(t){var e=t.__vue__;return e&&e.$options&&"transition-group"===e.$options._componentTag?e.$parent:e},emitChanges:function(t){var e=this;this.$nextTick((function(){e.$emit("change",t)}))},alterList:function(t){if(this.list)t(this.list);else{var e=Object(o["a"])(this.value);t(e),this.$emit("input",e)}},spliceList:function(){var t=arguments,e=function(e){return e.splice.apply(e,Object(o["a"])(t))};this.alterList(e)},updatePosition:function(t,e){var n=function(n){return n.splice(e,0,n.splice(t,1)[0])};this.alterList(n)},getRelatedContextFromMoveEvent:function(t){var e=t.to,n=t.related,o=this.getUnderlyingPotencialDraggableComponent(e);if(!o)return{component:o};var i=o.realList,a={list:i,component:o};if(e!==n&&i&&o.getUnderlyingVm){var s=o.getUnderlyingVm(n);if(s)return Object.assign(s,a)}return a},getVmIndex:function(t){var e=this.visibleIndexes,n=e.length;return t>n-1?n:e[t]},getComponent:function(){return this.$slots.default[0].componentInstance},resetTransitionData:function(t){if(this.noTransitionOnDrag&&this.transitionMode){var e=this.getChildrenNodes();e[t].data=null;var n=this.getComponent();n.children=[],n.kept=void 0}},onDragStart:function(t){this.context=this.getUnderlyingVm(t.item),this.isCloning=this.getIsCloning(),t.item._underlying_vm_=this.clone(this.context.element),g=t.item},onDragAdd:function(t){var e=t.item._underlying_vm_;if(void 0!==e){r(t.item);var n=this.getVmIndex(t.newIndex);this.spliceList(n,0,e),this.computeIndexes();var o={element:e,newIndex:n};this.emitChanges({added:o})}},onDragRemove:function(t){if(d(this.rootContainer,t.item,t.oldIndex),this.isCloning)r(t.clone);else{var e=this.context.index;this.spliceList(e,1);var n={element:this.context.element,oldIndex:e};this.resetTransitionData(e),this.emitChanges({removed:n})}},onDragUpdate:function(t){r(t.item),d(t.from,t.item,t.oldIndex);var e=this.context.index,n=this.getVmIndex(t.newIndex);this.updatePosition(e,n);var o={element:this.context.element,oldIndex:e,newIndex:n};this.emitChanges({moved:o})},updateProperty:function(t,e){t.hasOwnProperty(e)&&(t[e]+=this.headerOffset)},computeFutureIndex:function(t,e){if(!t.element)return 0;var n=Object(o["a"])(e.to.children).filter((function(t){return"none"!==t.style["display"]})),i=n.indexOf(e.related),a=t.component.getVmIndex(i),s=-1!=n.indexOf(g);return s||!e.willInsertAfter?a:a+1},onDragMove:function(t,e){var n=this.move;if(!n||!this.realList)return!0;var o=this.getRelatedContextFromMoveEvent(t),i=this.context,a=this.computeFutureIndex(o,t);return Object.assign(i,{futureIndex:a}),Object.assign(t,{relatedContext:o,draggedContext:i}),n(t,e)},onDragEnd:function(){this.computeIndexes(),g=null}}};e["a"]=I}).call(this,n("c8ba"))},ff6f:function(t,e,n){}});
//# sourceMappingURL=app.7428e9f2.js.map